<!DOCTYPE html>
<html>
<head>
    <title>Safety Training Mission: 10 Stages</title>
    <style>
        body { margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; background-color: #0f172a; font-family: 'Segoe UI', sans-serif; color: #f7fafc; overflow: hidden; user-select: none; }
        
        .main-controls { margin-bottom: 10px; display: flex; gap: 20px; align-items: center; background: #1e293b; padding: 10px 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        #start-menu { text-align: center; background: #1e293b; padding: 40px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); }
        .login-card { background: #1e293b; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; width: 320px; border: 1px solid #334155; }
        .input-group { text-align: left; margin-bottom: 20px; }
        .input-group label { color: #94a3b8; font-size: 14px; display: block; margin-bottom: 8px; }
        .input-group input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; outline: none; box-sizing: border-box; }
        
        #game-section { display: none; text-align: center; position: relative; }
        canvas { border: 4px solid #334155; background-color: #020617; border-radius: 12px; cursor: crosshair; }
        #score { font-size: 28px; font-weight: bold; color: #60a5fa; }

        .progress-container { width: 600px; height: 10px; background: #334155; border-radius: 10px; margin: 10px 0; overflow: hidden; }
        .progress-fill { width: 0%; height: 100%; background: linear-gradient(90deg, #60a5fa, #3b82f6); transition: width 0.5s ease; }

        .checkpoint-box { display: none; background: white; padding: 20px 30px; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.6); text-align: center; max-width: 850px; color: #1e293b; max-height: 95vh; overflow-y: auto; }

        /* STAGE 1: SMALLER CIRCLES */
        .diagram-wrapper { position: relative; width: 320px; height: 380px; background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSpPUDif2LkKX4bx3_sXJquY6_nF20kS_56aw&s'); background-size: contain; background-repeat: no-repeat; background-position: center; margin: 0 auto; }
        .part-target { position: absolute; border: 2px solid #3b82f6; background: rgba(59, 130, 246, 0.1); border-radius: 50%; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; font-size: 7px; font-weight: bold; text-align: center; line-height: 1; }
        .part-target.filled-correct { background: #1e3a8a !important; color: white !important; border-color: #1e40af; }
        
        .choice-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; justify-items: center; }
        .choice-box-uniform { width: 140px; padding: 8px 0; background: #2563eb; color: white; border-radius: 6px; cursor: grab; font-weight: bold; text-align: center; font-size: 13px; }

        /* STAGE 2: IPHONE */
        .iphone-frame { width: 240px; height: 480px; background: #000; border-radius: 40px; border: 8px solid #334155; margin: 0 auto; position: relative; padding: 12px; }
        .iphone-notch { width: 100px; height: 20px; background: #334155; position: absolute; top: 0; left: 50%; transform: translateX(-50%); border-bottom-left-radius: 15px; border-bottom-right-radius: 15px; }
        .iphone-screen { background: #000; height: 100%; border-radius: 28px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .iphone-display { color: #fff; font-size: 30px; height: 40px; width: 100%; text-align: center; margin-bottom: 15px; letter-spacing: 2px; display: flex; align-items: center; justify-content: center;}
        .iphone-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .iphone-key { width: 55px; height: 55px; background: #1c1c1e; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 22px; cursor: pointer; }
        .iphone-call { width: 60px; height: 60px; background: #34c759; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; cursor: pointer; border: none; margin-top: 15px; }

        /* GRID LOGIC */
        .person-container { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .person-drag { font-size: 50px; cursor: grab; padding: 8px; background: white; border-radius: 12px; border: 3px solid #3b82f6; }
        .drop-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .drop-zone { border: 2px dashed #94a3b8; border-radius: 12px; padding: 10px; display: flex; align-items: center; justify-content: center; background: #f1f5f9; min-height: 70px; font-size: 13px; font-weight: bold; text-align: center; }
        .filled-correct-grid { background: #dcfce7 !important; border: 2px solid #16a34a !important; color: #166534; }

        .pass-sentence { text-align: left; line-height: 2.2; font-size: 16px; background: #f8fafc; padding: 15px; border-radius: 12px; }
        .blank-inline { display: inline-flex; width: 100px; height: 30px; border-bottom: 3px solid #3b82f6; margin: 0 5px; vertical-align: middle; justify-content: center; align-items: center; font-weight: bold; color: #1e40af; }

        .btn { padding: 12px 30px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }
        .btn-green { background: #16a34a; color: white; display: none; margin: 15px auto 0; }
        .rainbow-grid { display: flex; gap: 5px; justify-content: center; margin-top: 15px; }
        .rainbow-box { width: 55px; height: 70px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 8px; font-weight: bold; color: white; text-transform: uppercase; }
        .rainbow-box.locked { pointer-events: none; opacity: 0.6; }
        .rainbow-box.correct-locked { pointer-events: none; border: 3px solid #16a34a; transform: scale(1.1); }
        .race-letter-box { font-size: 20px; font-weight: bold; color: #ef4444; margin: 3px; display: inline-block; min-width: 100px; padding: 10px; border: 2px solid #e2e8f0; border-radius: 10px; }
        
        #fail-overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); color: #ef4444; flex-direction: column; align-items: center; justify-content: center; z-index: 100; border-radius: 12px; }
    </style>
</head>
<body>

    <div id="login-screen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0f172a; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <div class="login-card">
            <h1 style="color: #60a5fa; margin-bottom: 20px;">Safety Mission</h1>
            <div class="input-group">
                <label>Employee No:</label>
                <input type="text" id="emp-id-input" placeholder="Enter ID (e.g. 1001)">
            </div>
            <div id="search-result" style="margin-bottom: 20px; padding: 10px; border-radius: 8px; background: rgba(59, 130, 246, 0.1); color: #60a5fa; display: none; font-weight: bold;">
                Welcome, <span id="player-name-span"></span>!
            </div>
            <button id="search-btn" onclick="searchEmployee()" style="width: 100%; padding: 12px; background: #3b82f6; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">SEARCH NAME</button>
            <button id="start-mission-btn" onclick="initGame()" style="width: 100%; padding: 12px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; display: none;">START MISSION</button>
            <p id="error-msg" style="color: #ef4444; font-size: 12px; margin-top: 10px; display: none;">ID not found.</p>
        </div>
    </div>

    <div class="main-controls" id="top-bar" style="display: none;">
        <div id="score">Score: 0</div>
        <button onclick="location.reload()" style="background:#ef4444; color:white; border:none; padding:8px 18px; border-radius:8px; cursor:pointer;">Emergency Reset</button>
    </div>

    <div id="game-section">
        <canvas id="gameCanvas"></canvas>
        <div id="fail-overlay">
            <h1 style="font-size: 40px;">MISSION FAILED</h1>
            <p style="color: white;">The fire reached the extinguisher!</p>
            <button class="btn" style="background:#ef4444; color:white; margin-top:15px;" onclick="location.reload()">RETRY MISSION</button>
        </div>
        <div class="progress-container"><div class="progress-fill" id="p-bar-main"></div></div>
    </div>

    <div id="quiz-section" class="checkpoint-box">
        <h3 style="margin: 0 0 10px 0;">Stage 1: Equipment Check</h3>
        <div class="diagram-wrapper">
            <div class="part-target" data-answer="HANDLE" style="top:42px; left:138px;"></div>
            <div class="part-target" data-answer="LEVER" style="top:92px; left:168px;"></div>
            <div class="part-target" data-answer="PIN" style="top:75px; left:148px;"></div>
            <div class="part-target" data-answer="PRESSURE GAUGE" style="top:85px; left:128px;"></div>
            <div class="part-target" data-answer="HOSE" style="top:140px; left:90px;"></div>
            <div class="part-target" data-answer="NOZZLE" style="top:270px; left:100px;"></div>
        </div>
        <div class="choice-grid">
            <div class="choice-box-uniform" draggable="true" ondragstart="drag(event)" id="L1">PRESSURE GAUGE</div>
            <div class="choice-box-uniform" draggable="true" ondragstart="drag(event)" id="L2">LEVER</div>
            <div class="choice-box-uniform" draggable="true" ondragstart="drag(event)" id="L3">NOZZLE</div>
            <div class="choice-box-uniform" draggable="true" ondragstart="drag(event)" id="L4">PIN</div>
            <div class="choice-box-uniform" draggable="true" ondragstart="drag(event)" id="L5">HOSE</div>
            <div class="choice-box-uniform" draggable="true" ondragstart="drag(event)" id="L6">HANDLE</div>
        </div>
        <button id="quizReturnBtn" class="btn btn-green" onclick="returnToGame('quiz-section')">CONTINUE ‚Üí</button>
    </div>

    <div id="phone-section" class="checkpoint-box">
        <h3>Stage 2: Emergency Response</h3>
        <p style="font-size: 14px;">What is St. Luke's Medical Center Emergency Number?</p>
        <div class="iphone-frame">
            <div class="iphone-notch"></div>
            <div class="iphone-screen">
                <div class="iphone-display" id="phone-display"></div>
                <div class="iphone-grid">
                    <div class="iphone-key" onclick="pressKey('1')">1</div><div class="iphone-key" onclick="pressKey('2')">2</div><div class="iphone-key" onclick="pressKey('3')">3</div>
                    <div class="iphone-key" onclick="pressKey('4')">4</div><div class="iphone-key" onclick="pressKey('5')">5</div><div class="iphone-key" onclick="pressKey('6')">6</div>
                    <div class="iphone-key" onclick="pressKey('7')">7</div><div class="iphone-key" onclick="pressKey('8')">8</div><div class="iphone-key" onclick="pressKey('9')">9</div>
                    <div class="iphone-key" style="color:#ff3b30; font-size:14px;" onclick="clearPhone()">DEL</div><div class="iphone-key" onclick="pressKey('0')">0</div><div class="iphone-key">#</div>
                </div>
                <button class="iphone-call" onclick="makeCall()">üìû</button>
            </div>
        </div>
        <div id="phone-msg" style="margin-top:10px; font-weight:bold;"></div>
    </div>

    <div id="grid-stage-section" class="checkpoint-box">
        <h2 id="grid-title"></h2>
        <div class="person-container">
            <div class="person-drag" id="person-logic" draggable="true" ondragstart="drag(event)">üö∂</div>
            <div style="background:#3b82f6; color:white; padding:8px 15px; border-radius:20px; font-weight:bold; font-size:14px;">Drag me to Safety</div>
        </div>
        <div class="drop-grid" id="main-drop-grid"></div>
        <div id="grid-msg" style="margin-top:10px; font-weight:bold;"></div>
        <button id="gridNextBtn" class="btn btn-green" onclick="returnToGame('grid-stage-section')">CONTINUE ‚Üí</button>
    </div>

    <div id="pass-section" class="checkpoint-box">
        <h2>Stage 4: PASS Protocol</h2>
        <div class="pass-sentence">
            Pull the <span class="blank-inline" ondragover="allowDrop(event)" ondrop="dropPass(event, 'PIN')"></span>,<br>
            Aim the <span class="blank-inline" ondragover="allowDrop(event)" ondrop="dropPass(event, 'NOZZLE')"></span> at base,<br>
            Squeeze the <span class="blank-inline" ondragover="allowDrop(event)" ondrop="dropPass(event, 'LEVER')"></span>,<br>
            <span class="blank-inline" ondragover="allowDrop(event)" ondrop="dropPass(event, 'SWEEP')"></span> from side to side.
        </div>
        <div id="pass-bank" style="display:flex; justify-content:center; margin-top:20px; gap:8px;"></div>
        <button id="passReturnBtn" class="btn btn-green" onclick="returnToGame('pass-section')">CONTINUE ‚Üí</button>
    </div>

    <div id="logic-box" class="checkpoint-box">
        <h2 id="logic-title"></h2>
        <p id="logic-desc" style="font-size:14px;"></p>
        <div id="logic-body"></div>
        <div id="logic-msg" style="margin-top:15px; font-weight:bold;"></div>
        <button id="logicNextBtn" class="btn btn-green" onclick="returnToGame('logic-box')">CONTINUE ‚Üí</button>
    </div>

    <div id="congrats" class="checkpoint-box">
        <h1 style="color:#2563eb;">Mission Accomplished! üèÜ</h1>
        <p style="font-size: 18px;">Congratulations! You have officially completed the Safety Training Mission.</p>
        <button class="btn" style="background:#2563eb; color:white;" onclick="location.reload()">PLAY AGAIN</button>
    </div>

<script>
/** --- EMPLOYEE LOOKUP LOGIC --- **/
const employeeData = { "1001": "Juan Dela Cruz", "1002": "Maria Santos", "12345": "Admin Hero" };
let currentPlayerName = "";

function searchEmployee() {
    const inputId = document.getElementById('emp-id-input').value.trim();
    if (employeeData[inputId]) {
        currentPlayerName = employeeData[inputId];
        document.getElementById('player-name-span').innerText = currentPlayerName;
        document.getElementById('search-result').style.display = "block";
        document.getElementById('start-mission-btn').style.display = "block";
        document.getElementById('search-btn').style.display = "none";
        document.getElementById('error-msg').style.display = "none";
    } else { document.getElementById('error-msg').style.display = "block"; }
}

function initGame() {
    document.getElementById('login-screen').style.display = "none";
    const nameTag = document.createElement('div');
    nameTag.style = "font-size: 14px; color: #94a3b8; margin-left: auto; margin-right: 20px;";
    nameTag.innerHTML = `Employee: <b>${currentPlayerName}</b>`;
    document.getElementById('top-bar').appendChild(nameTag);
    startGame();
}

/** --- GAME ENGINE --- **/
const canvas = document.getElementById("gameCanvas"); const ctx = canvas.getContext("2d"); canvas.width = 600; canvas.height = 300;
let score = 0, gameActive = false, isSpraying = false, fires = [], particles = [], cp = Array(11).fill(false), stagesFinished = 0;

function startGame() { document.getElementById("game-section").style.display="block"; document.getElementById("top-bar").style.display="flex"; gameActive=true; loop(); }

function update() {
    if (!gameActive) return;
    if (isSpraying) for(let i=0;i<6;i++) particles.push({x:90,y:220,vx:8+Math.random()*4,vy:(Math.random()-0.5)*4,life:25,size:4+Math.random()*8});
    for(let i=particles.length-1;i>=0;i--){particles[i].x+=particles[i].vx; particles[i].y+=particles[i].vy; if(--particles[i].life<=0)particles.splice(i,1);}
    if(Math.random()<0.04) fires.push({x:600,y:230});
    for(let i=fires.length-1;i>=0;i--){ 
        fires[i].x -= 3; 
        particles.forEach(p=>{
            if(fires[i]&&p.x>fires[i].x && p.x<fires[i].x+40 && p.y>fires[i].y && p.y<fires[i].y+40){
                fires.splice(i,1); score++; document.getElementById("score").innerText="Score: "+score; checkCheckpoint();
            }
        });
        // LOGIC: DEDUCT POINT IF FIRE REACHES EXTINGUISHER
        if(fires[i] && fires[i].x < 90) { 
            fires.splice(i, 1);
            if(score > 0) score--;
            document.getElementById("score").innerText="Score: "+score;
        }
    }
}
function draw(){
    ctx.clearRect(0,0,600,300); ctx.fillStyle="#1e293b"; ctx.fillRect(0,270,600,30); ctx.fillStyle="#ffffff";
    particles.forEach(p=>{ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill();}); 
    ctx.fillStyle="#ef4444"; ctx.fillRect(50,200,40,60); ctx.font="35px Arial"; fires.forEach(f=>ctx.fillText("üî•",f.x,f.y+30));
}
function loop(){if(gameActive){update(); draw(); requestAnimationFrame(loop);}}

window.addEventListener("mousedown", () => { isSpraying = true; });
window.addEventListener("mouseup", () => { isSpraying = false; });
window.addEventListener("keydown", (e) => { if (e.code === "Space") { e.preventDefault(); isSpraying = true; } });
window.addEventListener("keyup", (e) => { if (e.code === "Space") isSpraying = false; });

function checkCheckpoint() {
    const s = score;
    if (s===10 && !cp[0]) { cp[0]=true; showCP("quiz-section"); }
    else if (s===20 && !cp[1]) { cp[1]=true; showCP("phone-section"); }
    else if (s===30 && !cp[2]) { cp[2]=true; setupGrid(3); }
    else if (s===40 && !cp[3]) { cp[3]=true; setupPass(); }
    else if (s===50 && !cp[4]) { cp[4]=true; setupRace(); }
    else if (s===60 && !cp[5]) { cp[5]=true; setupCode(6); }
    else if (s===70 && !cp[6]) { cp[6]=true; setupCode(7); }
    else if (s===80 && !cp[7]) { cp[7]=true; setupCode(8); }
    else if (s===90 && !cp[8]) { cp[8]=true; setupGrid(9); }
    else if (s===100 && !cp[9]) { cp[9]=true; setupGrid(10); }
}

function showCP(id) { gameActive=false; document.getElementById("game-section").style.display="none"; document.getElementById(id).style.display="block"; }
function returnToGame(id) { stagesFinished++; document.getElementById("p-bar-main").style.width=(stagesFinished/10*100)+"%"; if(stagesFinished===10){document.getElementById(id).style.display="none"; document.getElementById("congrats").style.display="block"; return;} document.getElementById(id).style.display="none"; document.getElementById("game-section").style.display="block"; fires=[]; gameActive=true; loop(); }

/** DRAG LOGIC **/
function drag(e) { e.dataTransfer.setData("text", e.target.innerText); e.dataTransfer.setData("id", e.target.id); }
function allowDrop(e) { e.preventDefault(); }

document.querySelectorAll('.part-target').forEach(t => {
    t.ondragover = allowDrop;
    t.ondrop = (e) => {
        const data = e.dataTransfer.getData("text");
        if (data === t.dataset.answer) { 
            t.innerText = data; t.classList.add("filled-correct"); 
            document.getElementById(e.dataTransfer.getData("id")).style.visibility="hidden"; 
            if(document.querySelectorAll('.checkpoint-box[style*="block"] .part-target:not(.filled-correct)').length === 0) document.getElementById("quizReturnBtn").style.display="block"; 
        }
    };
});

function pressKey(n){const d=document.getElementById("phone-display"); if(d.innerText.length<4) d.innerText+=n;}
function clearPhone(){document.getElementById("phone-display").innerText="";}
function makeCall(){ if(document.getElementById("phone-display").innerText==="1111"){ document.getElementById("phone-display").innerText="Calling..."; setTimeout(()=>returnToGame("phone-section"), 1500);} else { clearPhone();}}

function setupPass(){
    showCP("pass-section"); const bank = document.getElementById("pass-bank"); bank.innerHTML="";
    const words = ["PIN", "NOZZLE", "LEVER", "SWEEP"].sort(()=>Math.random()-0.5);
    words.forEach((w,i)=> bank.innerHTML += `<div class="choice-box-uniform" style="width:100px; font-size:12px;" draggable="true" ondragstart="drag(event)" id="P${i}">${w}</div>`);
}
let pc = 0;
function dropPass(e, exp){ e.preventDefault(); const txt = e.dataTransfer.getData("text"); if(txt===exp){ e.target.innerText=txt; e.target.style.border="none"; document.getElementById(e.dataTransfer.getData("id")).style.visibility="hidden"; pc++; if(pc===4){ pc=0; document.getElementById("passReturnBtn").style.display="block"; } } }

let gStep = 0;
function setupGrid(stg){
    showCP("grid-stage-section"); const grid = document.getElementById("main-drop-grid"); grid.innerHTML = "";
    document.getElementById("gridNextBtn").style.display="none"; document.getElementById("grid-msg").innerText=""; gStep = 0;
    let items = [];
    if(stg===3) {
        document.getElementById("grid-title").innerText = "Earthquake Action Plan";
        items = [{t:"üôá DUCK", c:true, s:0}, {t:"üèÉ RUN", c:false}, {t:"üè¢ LIFT", c:false}, {t:"üõ°Ô∏è COVER", c:true, s:1}, {t:"ü™ü WINDOW", c:false}, {t:"‚úä HOLD", c:true, s:2}];
    } else if(stg===9) {
        document.getElementById("grid-title").innerText = "QC Assembly Areas";
        items = [{t:"üöó MAB Area", c:true}, {t:"üçï Shakey's", c:false}, {t:"üè• Sta. Ignaciana", c:true}, {t:"‚õ™ TUA Church", c:true}];
    } else {
        document.getElementById("grid-title").innerText = "Global City Assembly Areas";
        items = [{t:"üè® Rizal Lobby", c:true}, {t:"üõ£Ô∏è High St", c:false}, {t:"üè¢ 34th St", c:true}, {t:"üçî BGC Stop", c:false}];
    }
    const goal = items.filter(i=>i.c).length; let found = 0;
    items.forEach(item => {
        const z = document.createElement("div"); z.className="drop-zone"; z.innerText=item.t;
        z.ondragover = allowDrop;
        z.ondrop = (e) => {
            if(stg===3){
                if(item.c && item.s === gStep){ z.classList.add("filled-correct-grid"); z.innerText="‚úÖ "+item.t; gStep++; if(gStep===3) document.getElementById("gridNextBtn").style.display="block"; }
            } else {
                if(item.c && !z.classList.contains("filled-correct-grid")){ z.classList.add("filled-correct-grid"); z.innerText="‚úÖ "+item.t; found++; if(found===goal) document.getElementById("gridNextBtn").style.display="block"; }
            }
        };
        grid.appendChild(z);
    });
}

/** STAGE 5-8 LOGIC **/
const raceData = [{c:'r', o:['Run','Remove','Rescue','Rest'], a:'Rescue', e:'üöë'},{c:'a', o:['Attack','Alert','Aim','Alarm'], a:'Alarm', e:'üîî'},{c:'c', o:['Contain','Connect','Confine','Control'], a:'Confine', e:'üö™'},{c:'e', o:['Evacuate','Exit','Extinguish','Eat'], a:'Extinguish', e:'üßØ'}];
let currentLevel = 0, raceStep = 0;

function setupRace(){
    showCP("logic-box"); document.getElementById("logic-title").innerText="Stage 5: RACE Protocol";
    document.getElementById("logic-body").innerHTML = `<div id="rd"><div class="race-letter-box" id="rr">R</div><div class="race-letter-box" id="ra">A</div><div class="race-letter-box" id="rc">C</div><div class="race-letter-box" id="re">E</div></div><div id="ro" class="drop-grid"></div>`;
    raceStep = 0; drawRace();
}
function drawRace(){
    const o = document.getElementById("ro"); o.innerHTML="";
    if(raceStep<4) raceData[raceStep].o.forEach(opt => {
        const b = document.createElement("div"); b.className="drop-zone"; b.style.cursor="pointer"; b.innerText=opt;
        b.onclick=()=>{ if(opt===raceData[raceStep].a){ document.getElementById("r"+raceData[raceStep].c).innerText=raceData[raceStep].e+" "+opt; raceStep++; if(raceStep===4) document.getElementById("logicNextBtn").style.display="block"; else drawRace();} };
        o.appendChild(b);
    });
}

function setupCode(s){
    currentLevel = s; showCP("logic-box"); document.getElementById("logic-msg").innerText="";
    document.getElementById("logic-title").innerText=`Stage ${s}: Emergency Codes`;
    let q = s===6 ? "Fire, Chemical Spill, Radiation or Gas Leak, Earthquake, Flood?" : s===7 ? "Child Abduction?" : "Active Shooter?";
    document.getElementById("logic-desc").innerText="Code to activate during " + q;
    document.getElementById("logic-body").innerHTML = `<div class="rainbow-grid">
        <div class="rainbow-box r-item" style="background:#ff0000" onclick="chkC('Red', this)">Red</div>
        <div class="rainbow-box r-item" style="background:#ff7f00" onclick="chkC('Orange', this)">Orange</div>
        <div class="rainbow-box r-item" style="background:#ffff00" onclick="chkC('Yellow', this)">Yellow</div>
        <div class="rainbow-box r-item" style="background:#00ff00" onclick="chkC('Green', this)">Green</div>
        <div class="rainbow-box r-item" style="background:#0000ff" onclick="chkC('Blue', this)">Blue</div>
        <div class="rainbow-box r-item" style="background:#ff69b4" onclick="chkC('Pink', this)">Pink</div>
        <div class="rainbow-box r-item" style="background:#c0c0c0" onclick="chkC('Silver', this)">Silver</div></div>`;
}
function chkC(c, el){
    let win = (currentLevel===6 && c==='Orange') || (currentLevel===7 && c==='Pink') || (currentLevel===8 && c==='Silver');
    if(win){ 
        document.getElementById("logic-msg").innerText="Correct! ‚úÖ"; 
        document.getElementById("logicNextBtn").style.display="block"; 
        // Logic: Lock answers so they can't change
        document.querySelectorAll('.r-item').forEach(item => {
            item.classList.add('locked');
            if(item === el) item.classList.add('correct-locked');
        });
    } else {
        document.getElementById("logic-msg").innerText="Wrong code! ‚ùå";
    }
}
</script>
</body>
</html>
